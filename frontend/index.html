<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система управления практиками - ОмГТУ</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <span>ОмГТУ - Система практик</span>
            </div>
            <div class="user-info" id="userInfo">
                <!-- Заполняется через JS -->
            </div>
        </header>

        <nav>
            <a href="student.html" class="nav-link active">
                <i class="fas fa-user-graduate"></i> Личный кабинет
            </a>
            <a href="admin.html" class="nav-link" id="adminNav" style="display: none;">
                <i class="fas fa-chart-line"></i> Панель администратора
            </a>
            <div style="margin-left: auto;">
                <button onclick="auth.logout()" class="btn btn-outline" id="logoutBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> Выйти
                </button>
                <a href="login.html" class="btn btn-primary" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> Войти
                </a>
            </div>
        </nav>

        <main>
            <h1 class="section-title">
                <i class="fas fa-home"></i> Добро пожаловать в систему управления практиками
            </h1>
            
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3><i class="fas fa-users"></i> Общая статистика</h3>
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label">Всего пользователей</div>
                </div>
                
                <div class="dashboard-card">
                    <h3><i class="fas fa-briefcase"></i> Практики</h3>
                    <div class="stat-number" id="totalPractices">0</div>
                    <div class="stat-label">Активных практик</div>
                </div>
                
                <div class="dashboard-card">
                    <h3><i class="fas fa-book"></i> Дневники</h3>
                    <div class="stat-number" id="totalDiaryEntries">0</div>
                    <div class="stat-label">Всего записей</div>
                </div>
                
                <div class="dashboard-card">
                    <h3><i class="fas fa-user-graduate"></i> Студенты</h3>
                    <div class="stat-number" id="activeStudents">0</div>
                    <div class="stat-label">Проходящих практику</div>
                </div>
            </div>
            
            <div class="card" style="margin-top: 40px;">
                <h3><i class="fas fa-info-circle"></i> О системе</h3>
                <p>Система предназначена для управления учебными практиками студентов ОмГТУ.</p>
                <p><strong>Функционал для студентов:</strong></p>
                <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.6;">
                    <li>Просмотр информации о своей практике</li>
                    <li>Ведение дневника практики</li>
                    <li>Отслеживание индивидуальных заданий</li>
                    <li>Просмотр руководителей практики</li>
                </ul>
                
                <p style="margin-top: 20px;"><strong>Функционал для администраторов:</strong></p>
                <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.6;">
                    <li>Выполнение SQL запросов к базе данных</li>
                    <li>Работа с функциями и процедурами</li>
                    <li>Управление транзакциями</li>
                    <li>Генерация отчетов в PDF</li>
                </ul>
                
                <p style="margin-top: 20px; font-weight: bold; color: #667eea;">
                    <i class="fas fa-user"></i> Текущий пользователь: 
                    <span id="currentUserName">Не авторизован</span>
                </p>
            </div>
        </main>
    </div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Загружаем статистику при загрузке страницы
        async function loadDashboardStats() {
            try {
                const [users, practices, diary] = await Promise.all([
                    api.getAllUsers(),
                    api.getAllPractices(),
                    api.getAllDiaryEntries()
                ]);
                
                document.getElementById('totalUsers').textContent = users.length;
                document.getElementById('totalPractices').textContent = practices.length;
                document.getElementById('totalDiaryEntries').textContent = diary.length;
                document.getElementById('activeStudents').textContent = 
                    users.filter(u => u.username && u.username.startsWith('student')).length;
            } catch (error) {
                console.error('Ошибка загрузки статистики:', error);
            }
        }

        // Отображаем информацию о текущем пользователе
        function displayCurrentUser() {
            const user = auth.getCurrentUser();
            const userNameElement = document.getElementById('currentUserName');
            
            if (user) {
                userNameElement.textContent = `${user.fullName} (${user.isAdmin ? 'Администратор' : 'Студент'})`;
                userNameElement.style.color = user.isAdmin ? '#dc3545' : '#28a745';
            } else {
                userNameElement.textContent = 'Не авторизован';
                userNameElement.style.color = '#666';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Если пользователь не авторизован, показываем кнопку входа
            if (!auth.isAuthenticated()) {
                // Не перенаправляем автоматически, даем возможность остаться на главной
                console.log('Пользователь не авторизован');
            } else {
                console.log('Пользователь авторизован:', auth.getCurrentUser());
            }
            
            // Обновляем UI
            auth.updateUI();
            displayCurrentUser();
            loadDashboardStats();
            
            // Обновляем статистику каждые 30 секунд
            setInterval(loadDashboardStats, 30000);
        });
    </script>
</body>
</html>